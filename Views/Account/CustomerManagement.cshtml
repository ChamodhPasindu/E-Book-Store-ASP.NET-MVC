@model IEnumerable<EBookStore.Models.User>

@{
	ViewData["Title"] = "Admin Customer Management";
}

<div class="container mt-5">
	<h2>Customer Management</h2>

	<!-- Book Table -->
	<table class="table table-striped">
		<thead>
			<tr>
				<th>First Name</th>
				<th>Last Name</th>
				<th>Email</th>
				<th>Phone Number</th>
				<th>Address</th>
				<th>Actions</th>
			</tr>
		</thead>
		<tbody>
			@foreach (var customer in Model)
			{
				<tr>
					<td>@customer.FirstName</td>
					<td>@customer.LastName</td>
					<td>@customer.Email</td>
					<td>@customer.PhoneNumber</td>
					<td>@customer.RegistrationDate</td>
					<td>@customer.Address</td>
					<td>
						<button class="btn btn-info" data-toggle="modal" data-target="#viewCustomerModal" onclick="viewBook(@customer.UserID)">View</button>
						<button class="btn btn-danger" data-toggle="modal" data-target="#deleteConfirmationModal" data-book-id="@customer.UserID" onclick="deleteConfirm(@customer.UserID)">Delete</button>
					</td>
				</tr>
			}
		</tbody>
	</table>
</div>

<!-- View Customer Modal -->
 <div class="modal fade" id="viewCustomerModal" tabindex="-1" role="dialog" aria-labelledby="viewCustomerModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="viewCustomerModalLabel">Book Details</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="$('#viewCustomerModal').modal('hide')">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<p><strong>First Name:</strong> <span id="viewFirstName"></span></p>
				<p><strong>Last Name:</strong> <span id="viewLastName"></span></p>
				<p><strong>Email:</strong> <span id="viewEmail"></span></p>
				<p><strong>Phone Number:</strong> <span id="viewPhoneNumber"></span></p>
				<p><strong>Registration Date:</strong> <span id="viewRegistrationnDate"></span></p>
				<p><strong>Address:</strong> <span id="viewAddress"></span></p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="$('#viewCustomerModal').modal('hide')">Close</button>
			</div>
		</div>
	</div>
</div> 

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmationModal" tabindex="-1" role="dialog" aria-labelledby="deleteConfirmationModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="deleteConfirmationModalLabel">Confirm Delete</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="$('#deleteConfirmationModal').modal('hide')">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				Are you sure you want to delete this Customer?
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="$('#deleteConfirmationModal').modal('hide')">Cancel</button>
				<button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
			</div>
		</div>
	</div>
</div>

@section Scripts {
	<script>
	function viewBook(userId) {
			$.get('@Url.Action("GetCustomer")', { id: userId }, function (data) {
				console.log(data);

				$('#viewFirstName').text(data.firstName);
				$('#viewLastName').text(data.lastName);
				$('#viewEmail').text(data.email);
				$('#viewPhoneNumber').text(data.phoneNumber);
				$('#viewRegistrationnDate').text(data.registrationDate.split('T')[0]);
				$('#viewAddress').text(data.address);

				// Open the modal after setting data
				$('#viewCustomerModal').modal('show');
			});
		}

		function deleteConfirm(customerId) {
			$('#confirmDeleteBtn').data('customer-id', customerId);
			$('#deleteConfirmationModal').modal('show');
		}

		$('#confirmDeleteBtn').on('click', function () {
			var customerId = $(this).data('customer-id');

			$.ajax({
				url: '@Url.Action("Delete")',
				type: 'POST',
				data: { id: customerId },
				success: function (response) {
					location.reload();
				},
				error: function (err) {
					console.error('Error deleting book:', err);
				}
			});
		});
	</script>
}
